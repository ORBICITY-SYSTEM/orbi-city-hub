import{a$ as C,r as S,af as j,b0 as _,j as s,aE as F,ak as B,n as $,b1 as k,ad as q,i as H}from"./react-vendor-BIDRRw8F.js";import{s as v}from"./client-C3pdvDkS.js";import{B as L,C as t,a as r,b as o,c as i,d as D}from"./index-BLcOQO7i.js";import{B as d}from"./badge-BATP3r_Y.js";import{T as R,a as E,b as A,c as O}from"./tabs-D52QQNv5.js";import{u as K}from"./use-toast-2UsIGyGT.js";import{X as c}from"./vendor-INCMKllo.js";import"./trpc-vendor-wm-eNDph.js";const W=()=>{const{toast:b}=K(),u=C(),[p,g]=S.useState(!1),{data:x=[],isLoading:Q}=j({queryKey:["ota-bookings"],queryFn:async()=>{const{data:e,error:a}=await v.from("bookings").select("*").order("email_received_at",{ascending:!1});if(a)throw a;return e}}),{data:f=[]}=j({queryKey:["sync-logs"],queryFn:async()=>{const{data:e,error:a}=await v.from("sync_logs").select("*").order("started_at",{ascending:!1}).limit(10);if(a)throw a;return e}}),N=_({mutationFn:async()=>{const{data:e,error:a}=await v.functions.invoke("sync-ota-bookings");if(a)throw a;return e},onSuccess:e=>{b({title:"✓ Sync Complete",description:`${e.new_bookings} new bookings imported`}),u.invalidateQueries({queryKey:["ota-bookings"]}),u.invalidateQueries({queryKey:["sync-logs"]}),g(!1)},onError:e=>{b({title:"Sync Failed",description:e.message,variant:"destructive"}),g(!1)}}),y=()=>{g(!0),N.mutate()},n=x.filter(e=>!e.cancelled),T=n.reduce((e,a)=>e+(a.amount||0),0),w=n.reduce((e,a)=>e+(a.nights||0),0),M=n.length>0?T/n.length:0,h=n.reduce((e,a)=>{const m=a.channel;return e[m]||(e[m]={count:0,revenue:0}),e[m].count++,e[m].revenue+=a.amount||0,e},{}),l=f[0];return s.jsx("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:97",className:"min-h-screen bg-gradient-to-br from-background via-background to-primary/5 p-6",children:s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:98",className:"max-w-7xl mx-auto space-y-6",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:100",className:"flex items-center justify-between",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:101",children:[s.jsx("h1",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:102",className:"text-4xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent",children:"Orbi OTA Command Center"}),s.jsx("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:105",className:"text-muted-foreground mt-2",children:"Real-time booking analytics across all channels"})]}),s.jsxs(L,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:109",onClick:y,disabled:p,size:"lg",className:"gap-2",children:[s.jsx(F,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:115",className:`h-4 w-4 ${p?"animate-spin":""}`}),p?"Syncing...":"Sync Now"]})]}),l&&s.jsx(t,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:122",className:"border-primary/20",children:s.jsxs(r,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:123",className:"py-3 flex items-center justify-between",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:124",className:"flex items-center gap-3",children:[s.jsx(B,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:125",className:"h-5 w-5 text-primary"}),s.jsxs("span",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:126",className:"text-sm",children:["Last sync: ",c(new Date(l.started_at),"MMM dd, HH:mm")]}),s.jsx(d,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:129",variant:l.status==="completed"?"default":"destructive",children:l.status})]}),l.new_bookings>0&&s.jsxs("span",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:134",className:"text-sm text-muted-foreground",children:["+",l.new_bookings," new bookings"]})]})}),s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:143",className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsxs(t,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:144",children:[s.jsx(o,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:145",className:"pb-3",children:s.jsx(i,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:146",className:"text-sm font-medium text-muted-foreground",children:"Total Bookings"})}),s.jsxs(r,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:150",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:151",className:"flex items-center gap-2",children:[s.jsx($,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:152",className:"h-5 w-5 text-primary"}),s.jsx("span",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:153",className:"text-3xl font-bold",children:n.length})]}),s.jsxs("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:155",className:"text-xs text-muted-foreground mt-2",children:[x.filter(e=>e.cancelled).length," cancelled"]})]})]}),s.jsxs(t,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:161",children:[s.jsx(o,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:162",className:"pb-3",children:s.jsx(i,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:163",className:"text-sm font-medium text-muted-foreground",children:"Total Revenue"})}),s.jsxs(r,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:167",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:168",className:"flex items-center gap-2",children:[s.jsx(k,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:169",className:"h-5 w-5 text-primary"}),s.jsx("span",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:170",className:"text-3xl font-bold",children:T.toLocaleString("en-US",{maximumFractionDigits:0})})]}),s.jsxs("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:174",className:"text-xs text-muted-foreground mt-2",children:["Avg: €",M.toFixed(0)]})]})]}),s.jsxs(t,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:180",children:[s.jsx(o,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:181",className:"pb-3",children:s.jsx(i,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:182",className:"text-sm font-medium text-muted-foreground",children:"Total Nights"})}),s.jsxs(r,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:186",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:187",className:"flex items-center gap-2",children:[s.jsx(q,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:188",className:"h-5 w-5 text-primary"}),s.jsx("span",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:189",className:"text-3xl font-bold",children:w})]}),s.jsx("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:191",className:"text-xs text-muted-foreground mt-2",children:"Across all bookings"})]})]}),s.jsxs(t,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:197",children:[s.jsx(o,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:198",className:"pb-3",children:s.jsx(i,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:199",className:"text-sm font-medium text-muted-foreground",children:"Active Channels"})}),s.jsxs(r,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:203",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:204",className:"flex items-center gap-2",children:[s.jsx(H,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:205",className:"h-5 w-5 text-primary"}),s.jsx("span",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:206",className:"text-3xl font-bold",children:Object.keys(h).length})]}),s.jsx("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:210",className:"text-xs text-muted-foreground mt-2",children:"OTA platforms"})]})]})]}),s.jsxs(t,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:218",children:[s.jsxs(o,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:219",children:[s.jsx(i,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:220",children:"Channel Performance"}),s.jsx(D,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:221",children:"Revenue and booking count by OTA"})]}),s.jsx(r,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:223",children:s.jsx("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:224",className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(h).sort((e,a)=>a[1].revenue-e[1].revenue).map(([e,a])=>s.jsx(t,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:228",className:"border-primary/20",children:s.jsxs(r,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:229",className:"pt-6",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:230",className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:231",className:"font-semibold",children:e}),s.jsx(d,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:232",children:a.count})]}),s.jsxs("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:234",className:"text-2xl font-bold",children:["€",a.revenue.toLocaleString("en-US",{maximumFractionDigits:0})]}),s.jsxs("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:237",className:"text-xs text-muted-foreground mt-1",children:["Avg: €",(a.revenue/a.count).toFixed(0)]})]})},e))})})]}),s.jsxs(t,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:248",children:[s.jsxs(o,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:249",children:[s.jsx(i,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:250",children:"Recent Bookings"}),s.jsx(D,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:251",children:"Latest reservations from all channels"})]}),s.jsx(r,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:253",children:s.jsxs(R,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:254",defaultValue:"all",children:[s.jsxs(E,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:255",className:"mb-4",children:[s.jsx(A,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:256",value:"all",children:"All"}),Object.keys(h).map(e=>s.jsx(A,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:258",value:e,children:e},e))]}),s.jsx(O,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:264",value:"all",children:s.jsx("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:265",className:"space-y-3",children:x.slice(0,20).map(e=>s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:267",className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:271",className:"flex-1",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:272",className:"flex items-center gap-3 mb-1",children:[s.jsx(d,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:273",variant:"outline",children:e.channel}),s.jsx("span",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:274",className:"font-medium",children:e.guest_name||"Guest"}),e.cancelled&&s.jsx(d,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:276",variant:"destructive",children:"Cancelled"})]}),s.jsx("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:279",className:"text-sm text-muted-foreground",children:e.subject}),e.checkin&&s.jsxs("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:283",className:"text-xs text-muted-foreground mt-1",children:[c(new Date(e.checkin),"MMM dd")," →",e.checkout&&` ${c(new Date(e.checkout),"MMM dd")}`,e.nights&&` (${e.nights} nights)`]})]}),s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:290",className:"text-right",children:[s.jsx("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:291",className:"text-lg font-bold",children:e.amount?`€${e.amount.toFixed(0)}`:"-"}),s.jsx("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:294",className:"text-xs text-muted-foreground",children:c(new Date(e.email_received_at),"MMM dd, HH:mm")})]})]},e.id))})}),Object.keys(h).map(e=>s.jsx(O,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:304",value:e,children:s.jsx("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:305",className:"space-y-3",children:x.filter(a=>a.channel===e).slice(0,20).map(a=>s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:310",className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:314",className:"flex-1",children:[s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:315",className:"flex items-center gap-3 mb-1",children:[s.jsx("span",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:316",className:"font-medium",children:a.guest_name||"Guest"}),a.cancelled&&s.jsx(d,{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:318",variant:"destructive",children:"Cancelled"})]}),s.jsx("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:321",className:"text-sm text-muted-foreground",children:a.subject}),a.checkin&&s.jsxs("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:325",className:"text-xs text-muted-foreground mt-1",children:[c(new Date(a.checkin),"MMM dd")," →",a.checkout&&` ${c(new Date(a.checkout),"MMM dd")}`,a.nights&&` (${a.nights} nights)`]})]}),s.jsxs("div",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:332",className:"text-right",children:[s.jsx("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:333",className:"text-lg font-bold",children:a.amount?`€${a.amount.toFixed(0)}`:"-"}),s.jsx("p",{"data-loc":"client/src/pages/reservations/OTADashboard.tsx:336",className:"text-xs text-muted-foreground",children:c(new Date(a.email_received_at),"MMM dd, HH:mm")})]})]},a.id))})},e))]})})]})]})})};export{W as default};

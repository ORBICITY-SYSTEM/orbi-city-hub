import{j as t,a1 as $,o as G,am as _t,e as Vt,r as f,a6 as T,ao as Wt,ba as Gt,af as gt,n as ct,bl as Qt,bm as Xt,bn as Jt,I as Yt,H as Zt,a$ as te,b0 as ot,ah as Rt,aw as ee,a3 as Ct,ai as se,X as ne,bo as yt,aY as ae,ar as oe,W as Pt,bp as Ht,u as ce,aj as le,k as ie}from"./react-vendor-BIDRRw8F.js";import{T as qt,a as zt,b as B,c as K}from"./tabs-D52QQNv5.js";import{t as Q,C as b,B as S,T as vt,D as jt,e as re,f as bt,g as ft,h as Mt,i as de,j as u,q as At,b as kt,c as Tt,a as Et}from"./index-BLcOQO7i.js";import{u as F}from"./LanguageContext-DvTuhYl4.js";import{B as L}from"./badge-BATP3r_Y.js";import{S as tt,a as et,b as st,c as nt,d as E}from"./select-ANAJPCoK.js";import{I as Z}from"./input-BuEOZAZD.js";import{T as $t,a as Ut,b as lt,c as V,d as Ft,e as W}from"./table-CASaqgev.js";import{ak as mt,al as me,X as k}from"./vendor-INCMKllo.js";import{S as Nt}from"./scroll-area-C9ECY_El.js";import{s as _}from"./client-C3pdvDkS.js";import{u as xe,P as xt,a as ut,b as pt,H as ue}from"./HousekeepingModule-D6VGrHP8.js";import{t as pe}from"./use-toast-2UsIGyGT.js";import"./trpc-vendor-wm-eNDph.js";import"./label-KexGf_ya.js";function he(){const{t:e}=F(),{data:d=[],isLoading:a}=Q.logistics.housekeeping.list.useQuery(),{data:x=[],isLoading:y}=Q.logistics.maintenance.list.useQuery(),{data:i=[],isLoading:r}=Q.logistics.rooms.list.useQuery(),{data:M=[],isLoading:m}=Q.logistics.standardItems.list.useQuery(),{data:D=[],isLoading:v}=Q.logistics.roomInventory.list.useQuery();if(a||y||r||m||v)return t.jsx("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:43",className:"flex items-center justify-center p-8",children:t.jsx($,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:44",className:"h-8 w-8 animate-spin text-primary"})});const N=[],l=new Set;M.forEach(h=>{const j=[];let C=0;i.forEach(A=>{const at=D.find(O=>O.roomId===A.id&&O.standardItemId===h.id)?.actualQuantity??h.standardQuantity;if(at<h.standardQuantity){const O=h.standardQuantity-at;j.push({roomNumber:A.roomNumber,actualQuantity:at,missingCount:O}),C+=O,l.add(A.roomNumber)}}),j.length>0&&N.push({category:h.category,itemName:h.itemName,standardQuantity:h.standardQuantity,roomsWithIssues:j,totalMissing:C})});const R=N.reduce((h,j)=>(h[j.category]||(h[j.category]=[]),h[j.category].push(j),h),{}),H={};N.forEach(h=>{h.roomsWithIssues.forEach(j=>{H[j.roomNumber]||(H[j.roomNumber]=[]),H[j.roomNumber].push({itemName:h.itemName,missingCount:j.missingCount})})});const q=i.length,X=q-l.size,p=d?.length||0,P=d?.filter(h=>h.status==="completed").length||0,g=p-P,I=x?.length||0,U=x?.filter(h=>h.status==="completed").length||0,z=I-U,it=x?.reduce((h,j)=>h+(Number(j.actualCost||j.estimatedCost)||0),0)||0;return t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:128",className:"space-y-6",children:[t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:130",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(b,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:131",className:"p-6",children:t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:132",className:"flex items-center justify-between",children:[t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:133",children:[t.jsx("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:134",className:"text-sm text-muted-foreground",children:e("სულ ოთახები","Total Rooms")}),t.jsx("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:135",className:"text-3xl font-bold mt-2",children:q})]}),t.jsx(G,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:137",className:"h-10 w-10 text-primary"})]})}),t.jsx(b,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:141",className:"p-6",children:t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:142",className:"flex items-center justify-between",children:[t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:143",children:[t.jsx("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:144",className:"text-sm text-muted-foreground",children:e("ოთახები რიგზე","Rooms OK")}),t.jsx("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:145",className:"text-3xl font-bold mt-2 text-success",children:X})]}),t.jsx(_t,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:147",className:"h-10 w-10 text-success"})]})}),t.jsx(b,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:151",className:"p-6",children:t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:152",className:"flex items-center justify-between",children:[t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:153",children:[t.jsx("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:154",className:"text-sm text-muted-foreground",children:e("ოთახები პრობლემით","Rooms with Issues")}),t.jsx("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:155",className:"text-3xl font-bold mt-2 text-destructive",children:l.size})]}),t.jsx(Vt,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:157",className:"h-10 w-10 text-destructive"})]})}),t.jsx(b,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:161",className:"p-6",children:t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:162",className:"flex items-center justify-between",children:[t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:163",children:[t.jsx("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:164",className:"text-sm text-muted-foreground",children:e("ნაკლული ნივთები","Missing Items")}),t.jsx("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:165",className:"text-3xl font-bold mt-2 text-warning",children:N.length})]}),t.jsx(G,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:167",className:"h-10 w-10 text-warning"})]})})]}),t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:173",className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs(b,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:174",className:"p-6",children:[t.jsx("h3",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:175",className:"text-lg font-semibold mb-4",children:e("დასუფთავება","Housekeeping")}),t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:176",className:"space-y-3",children:[t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:177",className:"flex justify-between items-center",children:[t.jsx("span",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:178",className:"text-muted-foreground",children:e("სულ დავალებები","Total Tasks")}),t.jsx(L,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:179",variant:"outline",children:p})]}),t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:181",className:"flex justify-between items-center",children:[t.jsx("span",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:182",className:"text-muted-foreground",children:e("დასრულებული","Completed")}),t.jsx(L,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:183",variant:"default",children:P})]}),t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:185",className:"flex justify-between items-center",children:[t.jsx("span",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:186",className:"text-muted-foreground",children:e("მიმდინარე","Pending")}),t.jsx(L,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:187",variant:"secondary",children:g})]})]})]}),t.jsxs(b,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:192",className:"p-6",children:[t.jsx("h3",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:193",className:"text-lg font-semibold mb-4",children:e("ტექნიკური","Maintenance")}),t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:194",className:"space-y-3",children:[t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:195",className:"flex justify-between items-center",children:[t.jsx("span",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:196",className:"text-muted-foreground",children:e("სულ დავალებები","Total Tasks")}),t.jsx(L,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:197",variant:"outline",children:I})]}),t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:199",className:"flex justify-between items-center",children:[t.jsx("span",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:200",className:"text-muted-foreground",children:e("დასრულებული","Completed")}),t.jsx(L,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:201",variant:"default",children:U})]}),t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:203",className:"flex justify-between items-center",children:[t.jsx("span",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:204",className:"text-muted-foreground",children:e("მიმდინარე","Pending")}),t.jsx(L,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:205",variant:"secondary",children:z})]}),t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:207",className:"flex justify-between items-center",children:[t.jsx("span",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:208",className:"text-muted-foreground",children:e("ხარჯი","Cost")}),t.jsxs(L,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:209",variant:"destructive",children:["₾",it.toFixed(2)]})]})]})]})]}),Object.keys(R).length>0&&t.jsxs(b,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:217",className:"p-6",children:[t.jsx("h3",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:218",className:"text-lg font-semibold mb-4",children:e("ნაკლული ნივთები კატეგორიებით","Missing Items by Category")}),t.jsx("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:221",className:"space-y-4",children:Object.entries(R).map(([h,j])=>t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:223",className:"space-y-2",children:[t.jsx("h4",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:224",className:"font-semibold text-primary",children:e(h,h)}),j.map((C,A)=>t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:226",className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:227",children:[t.jsx("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:228",className:"font-medium",children:e(C.itemName,C.itemName)}),t.jsxs("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:229",className:"text-sm text-muted-foreground",children:[e("ნაკლული","Missing"),": ",C.totalMissing," ",e("ნივთი","items")," • ",C.roomsWithIssues.length," ",e("ოთახში","rooms")]})]}),t.jsx(L,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:233",variant:"destructive",children:C.totalMissing})]},A))]},h))})]}),Object.keys(H).length>0&&t.jsxs(b,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:244",className:"p-6",children:[t.jsx("h3",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:245",className:"text-lg font-semibold mb-4",children:e("ოთახები პრობლემით","Rooms with Issues")}),t.jsx("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:248",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(H).map(([h,j])=>t.jsxs(b,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:250",className:"p-4 border-destructive/20",children:[t.jsxs("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:251",className:"flex items-center justify-between mb-3",children:[t.jsxs("h4",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:252",className:"font-semibold",children:[e("ოთახი","Room")," ",h]}),t.jsx(L,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:253",variant:"destructive",children:j.length})]}),t.jsx("div",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:255",className:"space-y-1",children:j.map((C,A)=>t.jsxs("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:257",className:"text-sm text-muted-foreground",children:["• ",e(C.itemName,C.itemName),": -",C.missingCount]},A))})]},h))})]}),N.length===0&&t.jsxs(b,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:270",className:"p-8 text-center",children:[t.jsx(_t,{"data-loc":"client/src/components/InventoryDashboardStats.tsx:271",className:"h-16 w-16 text-success mx-auto mb-4"}),t.jsx("h3",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:272",className:"text-xl font-semibold text-success mb-2",children:e("ყველაფერი რიგზეა!","Everything is OK!")}),t.jsx("p",{"data-loc":"client/src/components/InventoryDashboardStats.tsx:275",className:"text-muted-foreground",children:e("ყველა ოთახის ინვენტარი სრულია","All rooms have complete inventory")})]})]})}function ge({roomId:e,roomNumber:d}){const{t:a}=F(),x=Q.useUtils(),[y,i]=f.useState({}),[r,M]=f.useState({}),[m,D]=f.useState({}),{data:v,isLoading:o}=Q.logistics.standardItems.list.useQuery(),{data:N,isLoading:l}=Q.logistics.roomInventory.getByRoomId.useQuery({roomId:e}),R=Q.logistics.roomInventory.upsert.useMutation({onSuccess:()=>{x.logistics.roomInventory.getByRoomId.invalidate({roomId:e}),x.logistics.roomInventory.list.invalidate(),T.success(a("ინვენტარი განახლდა","Inventory updated successfully"))},onError:p=>{T.error(a("შეცდომა","Error")+": "+p.message)}});f.useEffect(()=>{if(v&&N){const p={},P={},g={};v.forEach(I=>{const U=N.find(z=>z.standardItemId===I.id);p[I.id]=U?.actualQuantity??I.standardQuantity,P[I.id]=U?.condition??"good",g[I.id]=U?.notes??""}),i(p),M(P),D(g)}},[v,N]);const H=async()=>{if(v)try{for(const p of v){const P=y[p.id]??p.standardQuantity,g=r[p.id]??"good",I=m[p.id]||void 0;await R.mutateAsync({roomId:e,standardItemId:p.id,actualQuantity:P,condition:g,notes:I})}}catch(p){console.error("Failed to save inventory:",p)}},q=()=>{if(!v)return;const p=v.map(I=>({[a("კატეგორია","Category")]:I.category,[a("ნივთი","Item Name")]:I.itemName,[a("სტანდარტული რაოდენობა","Standard Quantity")]:I.standardQuantity,[a("ფაქტობრივი რაოდენობა","Actual Quantity")]:y[I.id]??I.standardQuantity,[a("მდგომარეობა","Condition")]:r[I.id]??"good",[a("შენიშვნები","Notes")]:m[I.id]??""})),P=mt.json_to_sheet(p),g=mt.book_new();mt.book_append_sheet(g,P,a("ინვენტარი","Inventory")),me(g,`Room_${d}_Inventory_${new Date().toISOString().split("T")[0]}.xlsx`),T.success(a("ექსპორტი წარმატებული","Exported successfully"))};if(o||l)return t.jsx("div",{"data-loc":"client/src/components/RoomInventoryTable.tsx:119",className:"flex items-center justify-center p-8",children:t.jsx($,{"data-loc":"client/src/components/RoomInventoryTable.tsx:120",className:"h-8 w-8 animate-spin text-primary"})});if(!v)return t.jsx(b,{"data-loc":"client/src/components/RoomInventoryTable.tsx:127",className:"p-8 text-center",children:t.jsx("p",{"data-loc":"client/src/components/RoomInventoryTable.tsx:128",className:"text-muted-foreground",children:a("სტანდარტული ნივთები ვერ მოიძებნა","Standard items not found")})});const X=Array.from(new Set(v.map(p=>p.category)));return t.jsx(b,{"data-loc":"client/src/components/RoomInventoryTable.tsx:139",className:"p-6",children:t.jsxs("div",{"data-loc":"client/src/components/RoomInventoryTable.tsx:140",className:"space-y-6",children:[t.jsxs("div",{"data-loc":"client/src/components/RoomInventoryTable.tsx:141",className:"flex items-center justify-between",children:[t.jsxs("div",{"data-loc":"client/src/components/RoomInventoryTable.tsx:142",children:[t.jsxs("h3",{"data-loc":"client/src/components/RoomInventoryTable.tsx:143",className:"text-lg font-semibold",children:[a("ოთახი","Room")," ",d," - ",a("ინვენტარი","Inventory")]}),t.jsx("p",{"data-loc":"client/src/components/RoomInventoryTable.tsx:146",className:"text-sm text-muted-foreground",children:a("განაახლეთ ინვენტარის რაოდენობა და მდგომარეობა","Update inventory quantity and condition")})]}),t.jsxs("div",{"data-loc":"client/src/components/RoomInventoryTable.tsx:150",className:"flex gap-2",children:[t.jsxs(S,{"data-loc":"client/src/components/RoomInventoryTable.tsx:151",variant:"outline",onClick:q,children:[t.jsx(Wt,{"data-loc":"client/src/components/RoomInventoryTable.tsx:152",className:"h-4 w-4 mr-2"}),a("ექსპორტი","Export")]}),t.jsxs(S,{"data-loc":"client/src/components/RoomInventoryTable.tsx:155",onClick:H,disabled:R.isPending,children:[R.isPending?t.jsx($,{"data-loc":"client/src/components/RoomInventoryTable.tsx:157",className:"h-4 w-4 mr-2 animate-spin"}):t.jsx(Gt,{"data-loc":"client/src/components/RoomInventoryTable.tsx:159",className:"h-4 w-4 mr-2"}),a("შენახვა","Save")]})]})]}),X.map(p=>{const P=v.filter(g=>g.category===p);return t.jsxs("div",{"data-loc":"client/src/components/RoomInventoryTable.tsx:169",className:"space-y-3",children:[t.jsx("h4",{"data-loc":"client/src/components/RoomInventoryTable.tsx:170",className:"font-semibold text-primary",children:a(p,p)}),t.jsxs($t,{"data-loc":"client/src/components/RoomInventoryTable.tsx:171",children:[t.jsx(Ut,{"data-loc":"client/src/components/RoomInventoryTable.tsx:172",children:t.jsxs(lt,{"data-loc":"client/src/components/RoomInventoryTable.tsx:173",children:[t.jsx(V,{"data-loc":"client/src/components/RoomInventoryTable.tsx:174",children:a("ნივთი","Item")}),t.jsx(V,{"data-loc":"client/src/components/RoomInventoryTable.tsx:175",className:"text-center",children:a("სტანდარტი","Standard")}),t.jsx(V,{"data-loc":"client/src/components/RoomInventoryTable.tsx:176",className:"text-center",children:a("ფაქტობრივი","Actual")}),t.jsx(V,{"data-loc":"client/src/components/RoomInventoryTable.tsx:177",className:"text-center",children:a("მდგომარეობა","Condition")}),t.jsx(V,{"data-loc":"client/src/components/RoomInventoryTable.tsx:178",children:a("შენიშვნები","Notes")})]})}),t.jsx(Ft,{"data-loc":"client/src/components/RoomInventoryTable.tsx:181",children:P.map(g=>{const U=(y[g.id]??g.standardQuantity)<g.standardQuantity;return t.jsxs(lt,{"data-loc":"client/src/components/RoomInventoryTable.tsx:186",children:[t.jsx(W,{"data-loc":"client/src/components/RoomInventoryTable.tsx:187",className:"font-medium",children:a(g.itemName,g.itemName)}),t.jsx(W,{"data-loc":"client/src/components/RoomInventoryTable.tsx:188",className:"text-center",children:t.jsx(L,{"data-loc":"client/src/components/RoomInventoryTable.tsx:189",variant:"outline",children:g.standardQuantity})}),t.jsx(W,{"data-loc":"client/src/components/RoomInventoryTable.tsx:191",className:"text-center",children:t.jsx(Z,{"data-loc":"client/src/components/RoomInventoryTable.tsx:192",type:"number",min:"0",value:y[g.id]??g.standardQuantity,onChange:z=>i({...y,[g.id]:parseInt(z.target.value)||0}),className:`w-20 text-center ${U?"border-destructive":""}`})}),t.jsx(W,{"data-loc":"client/src/components/RoomInventoryTable.tsx:202",className:"text-center",children:t.jsxs(tt,{"data-loc":"client/src/components/RoomInventoryTable.tsx:203",value:r[g.id]??"good",onValueChange:z=>M({...r,[g.id]:z}),children:[t.jsx(et,{"data-loc":"client/src/components/RoomInventoryTable.tsx:207",className:"w-32",children:t.jsx(st,{"data-loc":"client/src/components/RoomInventoryTable.tsx:208"})}),t.jsxs(nt,{"data-loc":"client/src/components/RoomInventoryTable.tsx:210",children:[t.jsx(E,{"data-loc":"client/src/components/RoomInventoryTable.tsx:211",value:"good",children:a("კარგი","Good")}),t.jsx(E,{"data-loc":"client/src/components/RoomInventoryTable.tsx:212",value:"fair",children:a("საშუალო","Fair")}),t.jsx(E,{"data-loc":"client/src/components/RoomInventoryTable.tsx:213",value:"poor",children:a("ცუდი","Poor")}),t.jsx(E,{"data-loc":"client/src/components/RoomInventoryTable.tsx:214",value:"missing",children:a("ნაკლული","Missing")})]})]})}),t.jsx(W,{"data-loc":"client/src/components/RoomInventoryTable.tsx:218",children:t.jsx(vt,{"data-loc":"client/src/components/RoomInventoryTable.tsx:219",placeholder:a("შენიშვნები...","Notes..."),value:m[g.id]??"",onChange:z=>D({...m,[g.id]:z.target.value}),className:"min-h-[60px]"})})]},g.id)})})]})]},p)})]})})}function ye({category:e}){const{t:d}=F(),{data:a,isLoading:x}=gt({queryKey:["category-inventory-history",e],queryFn:async()=>{const{data:{user:i}}=await _.auth.getUser();if(!i)throw new Error("Not authenticated");const{data:r,error:M}=await _.from("room_inventory_descriptions").select(`
          *,
          room:rooms(room_number)
        `).eq("user_id",i.id).order("description_date",{ascending:!1}).limit(100);if(M)throw M;return r}}),y=i=>{switch(i){case"შეცვლა/გატეხვა":return d("შეცვლა/გატეხვა","Replacement/Damage");case"დაკარგვა":return d("დაკარგვა","Loss");case"ნომრიდან ნომერში გადატანა":return d("ნომრიდან ნომერში გადატანა","Room Transfer");case"რეგულარული აღწერა":return d("რეგულარული აღწერა","Regular Inventory");default:return i}};return t.jsxs(jt,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:79",children:[t.jsx(re,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:80",asChild:!0,children:t.jsxs(S,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:81",variant:"outline",size:"sm",className:"gap-2",children:[t.jsx(ct,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:82",className:"h-4 w-4"}),d("ისტორია","History")]})}),t.jsxs(bt,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:86",className:"max-w-4xl max-h-[80vh]",children:[t.jsxs(ft,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:87",children:[t.jsxs(Mt,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:88",children:[d("კატეგორიის ცვლილებების ისტორია","Category Change History"),": ",e]}),t.jsx(de,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:91",children:d("ნახეთ ყველა ცვლილება ამ კატეგორიის ნივთებზე თარიღების მიხედვით","View all changes to items in this category by date")})]}),x?t.jsx("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:100",className:"flex items-center justify-center p-8",children:t.jsx($,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:101",className:"h-8 w-8 animate-spin text-primary"})}):!a||a.length===0?t.jsx("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:104",className:"text-center p-8 text-muted-foreground",children:d("ცვლილებების ისტორია არ მოიძებნა","No change history found")}):t.jsx(Nt,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:108",className:"h-[500px] pr-4",children:t.jsx("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:109",className:"space-y-4",children:a.map(i=>t.jsxs(b,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:111",className:"p-4",children:[t.jsxs("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:112",className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:113",className:"flex items-center gap-2",children:[t.jsx(L,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:114",variant:"secondary",children:i.room?.room_number||"N/A"}),t.jsx(L,{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:117",variant:"outline",children:y(i.change_type)})]}),t.jsx("span",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:121",className:"text-sm text-muted-foreground",children:k(new Date(i.description_date),"dd/MM/yyyy HH:mm")})]}),t.jsxs("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:126",className:"space-y-2 text-sm",children:[i.items_missing&&t.jsxs("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:128",children:[t.jsxs("span",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:129",className:"font-medium text-destructive",children:[d("ნაკლული ნივთები","Missing Items"),":"]})," ",i.items_missing]}),i.items_added&&t.jsxs("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:136",children:[t.jsxs("span",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:137",className:"font-medium text-green-600",children:[d("დამატებული ნივთები","Added Items"),":"]})," ",i.items_added]}),i.items_removed&&t.jsxs("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:144",children:[t.jsxs("span",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:145",className:"font-medium text-orange-600",children:[d("ამოღებული ნივთები","Removed Items"),":"]})," ",i.items_removed]}),i.transfer_from_room&&i.transfer_to_room&&t.jsxs("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:152",children:[t.jsxs("span",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:153",className:"font-medium",children:[d("გადატანა","Transfer"),":"]})," ",i.transfer_from_room," → ",i.transfer_to_room]}),i.notes&&t.jsxs("div",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:160",className:"mt-2 p-2 bg-muted rounded-md",children:[t.jsxs("span",{"data-loc":"client/src/components/CategoryInventoryHistory.tsx:161",className:"font-medium",children:[d("შენიშვნა","Notes"),":"]})," ",i.notes]})]})]},i.id))})})]})]})}function ve(){const{t:e}=F(),{data:d,isLoading:a}=Q.logistics.rooms.list.useQuery(),{data:x,isLoading:y}=Q.logistics.standardItems.list.useQuery(),{data:i,isLoading:r}=Q.logistics.roomInventory.list.useQuery();if(a||y||r)return t.jsx("div",{"data-loc":"client/src/components/AllRoomsInventory.tsx:43",className:"flex items-center justify-center p-8",children:t.jsx($,{"data-loc":"client/src/components/AllRoomsInventory.tsx:44",className:"h-8 w-8 animate-spin text-primary"})});if(!d||!x||!i)return t.jsx(b,{"data-loc":"client/src/components/AllRoomsInventory.tsx:51",className:"p-8 text-center",children:t.jsx("p",{"data-loc":"client/src/components/AllRoomsInventory.tsx:52",className:"text-muted-foreground",children:e("მონაცემები ვერ მოიძებნა","Data not found")})});const M=Array.from(new Set(x.map(o=>o.category))),m=(o,N)=>{const l=i.find(q=>q.roomId===o&&q.standardItemId===N);if(!l)return{status:"missing",quantity:0,condition:"missing"};const H=x.find(q=>q.id===N)?.standardQuantity||0;return l.actualQuantity<H?{status:"incomplete",quantity:l.actualQuantity,condition:l.condition}:l.condition==="poor"||l.condition==="fair"?{status:"warning",quantity:l.actualQuantity,condition:l.condition}:{status:"complete",quantity:l.actualQuantity,condition:l.condition}},D=o=>{switch(o){case"complete":return"default";case"incomplete":return"secondary";case"warning":return"destructive";case"missing":return"outline";default:return"outline"}},v=(o,N,l)=>o==="missing"?e("ნაკლული","Missing"):o==="incomplete"?`${N} ${e("ნაკლული","Missing")}`:o==="warning"?e(l==="poor"?"ცუდი":"საშუალო",l==="poor"?"Poor":"Fair"):e("კარგი","Good");return t.jsx(b,{"data-loc":"client/src/components/AllRoomsInventory.tsx:117",className:"p-6",children:t.jsxs("div",{"data-loc":"client/src/components/AllRoomsInventory.tsx:118",className:"space-y-4",children:[t.jsx("div",{"data-loc":"client/src/components/AllRoomsInventory.tsx:119",className:"flex items-center justify-between",children:t.jsxs("div",{"data-loc":"client/src/components/AllRoomsInventory.tsx:120",children:[t.jsx("h3",{"data-loc":"client/src/components/AllRoomsInventory.tsx:121",className:"text-lg font-semibold",children:e("ყველა ოთახის ინვენტარი","All Rooms Inventory")}),t.jsx("p",{"data-loc":"client/src/components/AllRoomsInventory.tsx:124",className:"text-sm text-muted-foreground",children:e("ყველა ოთახის ინვენტარის მიმოხილვა","Overview of inventory across all rooms")})]})}),t.jsxs(qt,{"data-loc":"client/src/components/AllRoomsInventory.tsx:130",defaultValue:"overview",className:"w-full",children:[t.jsxs(zt,{"data-loc":"client/src/components/AllRoomsInventory.tsx:131",children:[t.jsx(B,{"data-loc":"client/src/components/AllRoomsInventory.tsx:132",value:"overview",children:e("მიმოხილვა","Overview")}),M.map(o=>t.jsx(B,{"data-loc":"client/src/components/AllRoomsInventory.tsx:134",value:o,children:e(o,o)},o))]}),t.jsxs(K,{"data-loc":"client/src/components/AllRoomsInventory.tsx:140",value:"overview",className:"space-y-4",children:[t.jsx(Nt,{"data-loc":"client/src/components/AllRoomsInventory.tsx:141",className:"h-[600px] w-full rounded-md border",children:t.jsxs($t,{"data-loc":"client/src/components/AllRoomsInventory.tsx:142",children:[t.jsx(Ut,{"data-loc":"client/src/components/AllRoomsInventory.tsx:143",children:t.jsxs(lt,{"data-loc":"client/src/components/AllRoomsInventory.tsx:144",children:[t.jsx(V,{"data-loc":"client/src/components/AllRoomsInventory.tsx:145",className:"sticky left-0 z-10 bg-background",children:e("ოთახი","Room")}),x.map(o=>t.jsx(V,{"data-loc":"client/src/components/AllRoomsInventory.tsx:149",className:"text-center min-w-[120px]",children:e(o.itemName,o.itemName)},o.id))]})}),t.jsx(Ft,{"data-loc":"client/src/components/AllRoomsInventory.tsx:155",children:d.map(o=>t.jsxs(lt,{"data-loc":"client/src/components/AllRoomsInventory.tsx:157",children:[t.jsx(W,{"data-loc":"client/src/components/AllRoomsInventory.tsx:158",className:"sticky left-0 z-10 bg-background font-medium",children:o.roomNumber}),x.map(N=>{const l=m(o.id,N.id);return t.jsx(W,{"data-loc":"client/src/components/AllRoomsInventory.tsx:164",className:"text-center",children:t.jsx(L,{"data-loc":"client/src/components/AllRoomsInventory.tsx:165",variant:D(l.status),children:v(l.status,l.quantity,l.condition)})},N.id)})]},o.id))})]})}),t.jsxs("div",{"data-loc":"client/src/components/AllRoomsInventory.tsx:177",className:"flex items-center gap-4 text-sm text-muted-foreground",children:[t.jsxs("div",{"data-loc":"client/src/components/AllRoomsInventory.tsx:178",className:"flex items-center gap-2",children:[t.jsx(L,{"data-loc":"client/src/components/AllRoomsInventory.tsx:179",variant:"default",children:e("კარგი","Good")}),t.jsx("span",{"data-loc":"client/src/components/AllRoomsInventory.tsx:180",children:e("ყველაფერი რიგზეა","All good")})]}),t.jsxs("div",{"data-loc":"client/src/components/AllRoomsInventory.tsx:182",className:"flex items-center gap-2",children:[t.jsx(L,{"data-loc":"client/src/components/AllRoomsInventory.tsx:183",variant:"secondary",children:e("ნაკლული","Missing")}),t.jsx("span",{"data-loc":"client/src/components/AllRoomsInventory.tsx:184",children:e("რაოდენობა არასაკმარისია","Quantity insufficient")})]}),t.jsxs("div",{"data-loc":"client/src/components/AllRoomsInventory.tsx:186",className:"flex items-center gap-2",children:[t.jsx(L,{"data-loc":"client/src/components/AllRoomsInventory.tsx:187",variant:"destructive",children:e("ცუდი","Poor")}),t.jsx("span",{"data-loc":"client/src/components/AllRoomsInventory.tsx:188",children:e("მდგომარეობა ცუდია","Condition poor")})]}),t.jsxs("div",{"data-loc":"client/src/components/AllRoomsInventory.tsx:190",className:"flex items-center gap-2",children:[t.jsx(L,{"data-loc":"client/src/components/AllRoomsInventory.tsx:191",variant:"outline",children:e("ნაკლული","Missing")}),t.jsx("span",{"data-loc":"client/src/components/AllRoomsInventory.tsx:192",children:e("ნივთი არ არის","Item missing")})]})]})]}),M.map(o=>t.jsx(K,{"data-loc":"client/src/components/AllRoomsInventory.tsx:198",value:o,children:t.jsx(ye,{"data-loc":"client/src/components/AllRoomsInventory.tsx:199",category:o})},o))]})]})})}function je(){const{t:e}=F(),[d,a]=f.useState(""),{data:x,isLoading:y}=Q.logistics.rooms.list.useQuery();if(y)return t.jsx("div",{"data-loc":"client/src/components/StudioInventoryList.tsx:18",className:"flex items-center justify-center p-8",children:t.jsx($,{"data-loc":"client/src/components/StudioInventoryList.tsx:19",className:"h-8 w-8 animate-spin text-primary"})});if(!x||x.length===0)return t.jsxs(b,{"data-loc":"client/src/components/StudioInventoryList.tsx:26",className:"p-8 text-center",children:[t.jsx("p",{"data-loc":"client/src/components/StudioInventoryList.tsx:27",className:"text-muted-foreground mb-4",children:e("ოთახები ვერ მოიძებნა","No rooms found")}),t.jsx("p",{"data-loc":"client/src/components/StudioInventoryList.tsx:30",className:"text-sm text-muted-foreground",children:e("გთხოვთ დაუკავშირდეთ ადმინისტრატორს","Please contact administrator")})]});const i=x.find(r=>r.id.toString()===d);return t.jsxs("div",{"data-loc":"client/src/components/StudioInventoryList.tsx:40",className:"space-y-6",children:[t.jsx(b,{"data-loc":"client/src/components/StudioInventoryList.tsx:41",className:"p-6",children:t.jsxs("div",{"data-loc":"client/src/components/StudioInventoryList.tsx:42",className:"space-y-4",children:[t.jsxs("div",{"data-loc":"client/src/components/StudioInventoryList.tsx:43",children:[t.jsx("h3",{"data-loc":"client/src/components/StudioInventoryList.tsx:44",className:"text-lg font-semibold mb-2",children:e("სტუდიოს ინვენტარის მართვა","Studio Inventory Management")}),t.jsx("p",{"data-loc":"client/src/components/StudioInventoryList.tsx:47",className:"text-sm text-muted-foreground",children:e("აირჩიეთ ოთახი ინვენტარის დასათვალიერებლად და განსაახლებლად","Select a room to view and update its inventory")})]}),t.jsxs("div",{"data-loc":"client/src/components/StudioInventoryList.tsx:55",className:"flex items-center gap-4",children:[t.jsxs("label",{"data-loc":"client/src/components/StudioInventoryList.tsx:56",className:"text-sm font-medium",children:[e("აირჩიეთ ოთახი","Select Room"),":"]}),t.jsxs(tt,{"data-loc":"client/src/components/StudioInventoryList.tsx:57",value:d,onValueChange:a,children:[t.jsx(et,{"data-loc":"client/src/components/StudioInventoryList.tsx:58",className:"w-[200px]",children:t.jsx(st,{"data-loc":"client/src/components/StudioInventoryList.tsx:59",placeholder:e("ოთახის ნომერი","Room Number")})}),t.jsxs(nt,{"data-loc":"client/src/components/StudioInventoryList.tsx:61",children:[t.jsx(E,{"data-loc":"client/src/components/StudioInventoryList.tsx:62",value:"all",children:e("ყველა ოთახი","All Rooms")}),x.map(r=>t.jsxs(E,{"data-loc":"client/src/components/StudioInventoryList.tsx:64",value:r.id.toString(),children:[e("ოთახი","Room")," ",r.roomNumber]},r.id))]})]})]})]})}),d==="all"?t.jsx(ve,{"data-loc":"client/src/components/StudioInventoryList.tsx:75"}):i?t.jsx(ge,{"data-loc":"client/src/components/StudioInventoryList.tsx:77",roomId:i.id,roomNumber:i.roomNumber}):null]})}function ht({className:e,classNames:d,showOutsideDays:a=!0,captionLayout:x="label",buttonVariant:y="ghost",formatters:i,components:r,...M}){const m=Qt();return t.jsx(Xt,{"data-loc":"client/src/components/ui/calendar.tsx:27",showOutsideDays:a,className:u("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,e),captionLayout:x,formatters:{formatMonthDropdown:D=>D.toLocaleString("default",{month:"short"}),...i},classNames:{root:u("w-fit",m.root),months:u("flex gap-4 flex-col md:flex-row relative",m.months),month:u("flex flex-col w-full gap-4",m.month),nav:u("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",m.nav),button_previous:u(At({variant:y}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",m.button_previous),button_next:u(At({variant:y}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",m.button_next),month_caption:u("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",m.month_caption),dropdowns:u("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",m.dropdowns),dropdown_root:u("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",m.dropdown_root),dropdown:u("absolute bg-popover inset-0 opacity-0",m.dropdown),caption_label:u("select-none font-medium",x==="label"?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",m.caption_label),table:"w-full border-collapse",weekdays:u("flex",m.weekdays),weekday:u("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",m.weekday),week:u("flex w-full mt-2",m.week),week_number_header:u("select-none w-(--cell-size)",m.week_number_header),week_number:u("text-[0.8rem] select-none text-muted-foreground",m.week_number),day:u("relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",m.day),range_start:u("rounded-l-md bg-accent",m.range_start),range_middle:u("rounded-none",m.range_middle),range_end:u("rounded-r-md bg-accent",m.range_end),today:u("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",m.today),outside:u("text-muted-foreground aria-selected:text-muted-foreground",m.outside),disabled:u("text-muted-foreground opacity-50",m.disabled),hidden:u("invisible",m.hidden),...d},components:{Root:({className:D,rootRef:v,...o})=>t.jsx("div",{"data-loc":"client/src/components/ui/calendar.tsx:128","data-slot":"calendar",ref:v,className:u(D),...o}),Chevron:({className:D,orientation:v,...o})=>v==="left"?t.jsx(Jt,{"data-loc":"client/src/components/ui/calendar.tsx:139",className:u("size-4",D),...o}):v==="right"?t.jsx(Yt,{"data-loc":"client/src/components/ui/calendar.tsx:145",className:u("size-4",D),...o}):t.jsx(Zt,{"data-loc":"client/src/components/ui/calendar.tsx:153",className:u("size-4",D),...o}),DayButton:be,WeekNumber:({children:D,...v})=>t.jsx("td",{"data-loc":"client/src/components/ui/calendar.tsx:159",...v,children:t.jsx("div",{"data-loc":"client/src/components/ui/calendar.tsx:160",className:"flex size-(--cell-size) items-center justify-center text-center",children:D})}),...r},...M})}function be({className:e,day:d,modifiers:a,...x}){const y=Qt(),i=f.useRef(null);return f.useEffect(()=>{a.focused&&i.current?.focus()},[a.focused]),t.jsx(S,{"data-loc":"client/src/components/ui/calendar.tsx:187",ref:i,variant:"ghost",size:"icon","data-day":d.date.toLocaleDateString(),"data-selected-single":a.selected&&!a.range_start&&!a.range_end&&!a.range_middle,"data-range-start":a.range_start,"data-range-end":a.range_end,"data-range-middle":a.range_middle,className:u("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",y.day,e),...x})}const fe=()=>{const{t:e}=F(),d=te(),{logActivity:a}=xe(),x=f.useRef(null),y=f.useRef(null),[i,r]=f.useState([]),[M,m]=f.useState(!1),[D,v]=f.useState(!1),[o,N]=f.useState(null),[l,R]=f.useState(null),[H,q]=f.useState(!1),{data:X}=gt({queryKey:["rooms"],queryFn:async()=>{const{data:s,error:n}=await _.from("rooms").select("*").order("room_number");if(n)throw n;return s}}),{data:p}=gt({queryKey:["maintenance-schedules"],queryFn:async()=>{const{data:s,error:n}=await _.from("maintenance_schedules").select("*").order("scheduled_date",{ascending:!1});if(n)throw n;return s}}),P=ot({mutationFn:async s=>{const{data:{user:n}}=await _.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:c,error:w}=await _.from("maintenance_schedules").insert({user_id:n.id,scheduled_date:k(s.scheduled_date,"yyyy-MM-dd"),room_number:s.room_number,problem:s.problem,notes:s.notes,status:s.status,solving_date:s.solving_date?k(s.solving_date,"yyyy-MM-dd"):null,cost:s.cost||0}).select().single();if(w)throw w;return c},onSuccess:async(s,n)=>{await a({action:"create",entityType:"maintenance_schedule",entityId:s.id,entityName:`Room ${n.room_number} - ${n.problem}`,changes:{problem:n.problem,status:n.status,cost:n.cost}}),d.invalidateQueries({queryKey:["maintenance-schedules"]}),d.invalidateQueries({queryKey:["logistics-activity-log"]}),T.success(e("მონაცემები წარმატებით შეინახა","Schedule saved successfully")),r([])},onError:s=>{console.error("Error saving schedule:",s),T.error(e("შეცდომა მონაცემების შენახვისას","Error saving schedule"))}}),g=ot({mutationFn:async({id:s,updates:n})=>{const c={...n,updated_at:new Date().toISOString()};n.scheduled_date&&(c.scheduled_date=k(n.scheduled_date,"yyyy-MM-dd")),n.solving_date&&(c.solving_date=k(n.solving_date,"yyyy-MM-dd")),n.status==="completed"&&!c.solving_date&&(c.solving_date=k(new Date,"yyyy-MM-dd"),c.completed_at=new Date().toISOString()),n.cost!==void 0&&(c.cost=n.cost);const{error:w}=await _.from("maintenance_schedules").update(c).eq("id",s);if(w)throw w},onSuccess:async(s,{id:n,updates:c})=>{const w=p?.find(rt=>rt.id===n);await a({action:"update",entityType:"maintenance_schedule",entityId:n,entityName:w?`Room ${w.room_number}`:void 0,changes:c}),d.invalidateQueries({queryKey:["maintenance-schedules"]}),d.invalidateQueries({queryKey:["logistics-activity-log"]}),T.success(e("მონაცემები განახლდა","Schedule updated"))}}),I=ot({mutationFn:async s=>{const{error:n}=await _.from("maintenance_schedules").delete().eq("id",s);if(n)throw n},onSuccess:async(s,n)=>{const c=p?.find(w=>w.id===n);await a({action:"delete",entityType:"maintenance_schedule",entityId:n,entityName:c?`Room ${c.room_number} - ${c.problem}`:void 0}),d.invalidateQueries({queryKey:["maintenance-schedules"]}),d.invalidateQueries({queryKey:["logistics-activity-log"]}),T.success(e("ჩანაწერი წაიშალა","Entry deleted"))}}),U=ot({mutationFn:async({id:s,media_urls:n})=>{const{error:c}=await _.from("maintenance_schedules").update({media_urls:n,updated_at:new Date().toISOString()}).eq("id",s);if(c)throw c},onSuccess:()=>{d.invalidateQueries({queryKey:["maintenance-schedules"]})}}),z=async(s,n)=>{if(!(!n||n.length===0)){q(!0);try{const{data:{user:c}}=await _.auth.getUser();if(!c)throw new Error("User not authenticated");const w=[];for(let Y=0;Y<n.length;Y++){const St=n[Y],Bt=St.name.split(".").pop(),Lt=`${c.id}/${s}_${Date.now()}_${Y}.${Bt}`,{error:Dt}=await _.storage.from("housekeeping-media").upload(Lt,St);if(Dt)throw Dt;const{data:{publicUrl:Kt}}=_.storage.from("housekeeping-media").getPublicUrl(Lt);w.push(Kt)}const J=[...p?.find(Y=>Y.id===s)?.media_urls||[],...w];await U.mutateAsync({id:s,media_urls:J}),o?.id===s&&N({...o,media_urls:J}),T.success(e("ფაილები აიტვირთა","Files uploaded successfully"))}catch(c){console.error("Error uploading files:",c),T.error(e("შეცდომა ფაილების ატვირთვისას","Error uploading files"))}finally{q(!1),x.current&&(x.current.value=""),y.current&&(y.current.value="")}}},it=async(s,n)=>{try{const c=n.split("/").slice(-2).join("/"),{error:w}=await _.storage.from("housekeeping-media").remove([c]);if(w)throw w;const dt=(p?.find(J=>J.id===s)?.media_urls||[]).filter(J=>J!==n);await U.mutateAsync({id:s,media_urls:dt}),o?.id===s&&N({...o,media_urls:dt}),T.success(e("ფაილი წაიშალა","File deleted"))}catch(c){console.error("Error deleting media:",c),T.error(e("შეცდომა ფაილის წაშლისას","Error deleting file"))}},h=async(s,n)=>{try{const{error:c}=await _.from("maintenance_schedules").update({additional_notes:n,updated_at:new Date().toISOString()}).eq("id",s);if(c)throw c;d.invalidateQueries({queryKey:["maintenance-schedules"]}),T.success(e("კომენტარი შეინახა","Comment saved"))}catch(c){console.error("Error updating notes:",c),T.error(e("შეცდომა კომენტარის შენახვისას","Error saving comment"))}},j=()=>{r([...i,{scheduled_date:new Date,room_number:"",problem:"",notes:"",status:"pending",solving_date:null,cost:0}])},C=s=>{r(i.filter((n,c)=>c!==s))},A=(s,n,c)=>{const w=[...i];w[s]={...w[s],[n]:c},r(w)},It=()=>{const s=i.filter(n=>n.room_number&&n.problem);if(s.length===0){T.error(e("შეავსეთ ველები","Please fill in required fields"));return}s.forEach(n=>{P.mutate(n)})},at=s=>{R({id:s.id,scheduled_date:new Date(s.scheduled_date),room_number:s.room_number,problem:s.problem,notes:s.notes||"",status:s.status,solving_date:s.solving_date?new Date(s.solving_date):null,cost:s.cost||0}),m(!0)},O=s=>{N(s),v(!0)},Ot=()=>{l?.id&&g.mutate({id:l.id,updates:{scheduled_date:l.scheduled_date,room_number:l.room_number,problem:l.problem,notes:l.notes,status:l.status,solving_date:l.solving_date,cost:l.cost}},{onSuccess:()=>{m(!1),R(null)}})},wt=s=>{const n={pending:{variant:"outline",label:e("მოლოდინში","Pending")},in_progress:{variant:"secondary",label:e("მიმდინარე","In Progress")},completed:{variant:"default",label:e("დასრულებული","Completed")}},c=n[s]||n.pending;return t.jsx(L,{"data-loc":"client/src/components/MaintenanceModule.tsx:379",variant:c.variant,children:c.label})};return t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:383",className:"space-y-6",children:[t.jsxs(b,{"data-loc":"client/src/components/MaintenanceModule.tsx:384",children:[t.jsx(kt,{"data-loc":"client/src/components/MaintenanceModule.tsx:385",children:t.jsx(Tt,{"data-loc":"client/src/components/MaintenanceModule.tsx:386",children:e("ტექნიკური გაუმართაობა","Maintenance Schedule")})}),t.jsxs(Et,{"data-loc":"client/src/components/MaintenanceModule.tsx:388",className:"space-y-4",children:[i.map((s,n)=>t.jsx(b,{"data-loc":"client/src/components/MaintenanceModule.tsx:390",className:"p-4",children:t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:391",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:392",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:393",className:"text-sm font-medium mb-2 block",children:e("თარიღი","Date")}),t.jsxs(xt,{"data-loc":"client/src/components/MaintenanceModule.tsx:396",children:[t.jsx(ut,{"data-loc":"client/src/components/MaintenanceModule.tsx:397",asChild:!0,children:t.jsxs(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:398",variant:"outline",className:"w-full justify-start text-left",children:[t.jsx(ct,{"data-loc":"client/src/components/MaintenanceModule.tsx:399",className:"mr-2 h-4 w-4"}),k(s.scheduled_date,"PPP")]})}),t.jsx(pt,{"data-loc":"client/src/components/MaintenanceModule.tsx:403",className:"w-auto p-0",align:"start",children:t.jsx(ht,{"data-loc":"client/src/components/MaintenanceModule.tsx:404",mode:"single",selected:s.scheduled_date,onSelect:c=>c&&A(n,"scheduled_date",c),initialFocus:!0,className:u("p-3 pointer-events-auto")})})]})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:417",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:418",className:"text-sm font-medium mb-2 block",children:e("ოთახი","Room")}),t.jsxs(tt,{"data-loc":"client/src/components/MaintenanceModule.tsx:421",value:s.room_number,onValueChange:c=>A(n,"room_number",c),children:[t.jsx(et,{"data-loc":"client/src/components/MaintenanceModule.tsx:425",children:t.jsx(st,{"data-loc":"client/src/components/MaintenanceModule.tsx:426",placeholder:e("აირჩიეთ ოთახი","Select room")})}),t.jsx(nt,{"data-loc":"client/src/components/MaintenanceModule.tsx:428",children:X?.map(c=>t.jsxs(E,{"data-loc":"client/src/components/MaintenanceModule.tsx:430",value:c.room_number,children:[e("ოთახი","Room")," #",c.room_number]},c.id))})]})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:438",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:439",className:"text-sm font-medium mb-2 block",children:e("პრობლემა","Problem")}),t.jsx(Z,{"data-loc":"client/src/components/MaintenanceModule.tsx:442",value:s.problem,onChange:c=>A(n,"problem",c.target.value),placeholder:e("აღწერეთ პრობლემა","Describe the problem")})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:449",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:450",className:"text-sm font-medium mb-2 block",children:e("შენიშვნა","Notes")}),t.jsx(Z,{"data-loc":"client/src/components/MaintenanceModule.tsx:453",value:s.notes,onChange:c=>A(n,"notes",c.target.value),placeholder:e("დამატებითი ინფორმაცია","Additional info")})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:460",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:461",className:"text-sm font-medium mb-2 block",children:e("სტატუსი","Status")}),t.jsxs(tt,{"data-loc":"client/src/components/MaintenanceModule.tsx:464",value:s.status,onValueChange:c=>A(n,"status",c),children:[t.jsx(et,{"data-loc":"client/src/components/MaintenanceModule.tsx:468",children:t.jsx(st,{"data-loc":"client/src/components/MaintenanceModule.tsx:469"})}),t.jsxs(nt,{"data-loc":"client/src/components/MaintenanceModule.tsx:471",children:[t.jsx(E,{"data-loc":"client/src/components/MaintenanceModule.tsx:472",value:"pending",children:e("მოლოდინში","Pending")}),t.jsx(E,{"data-loc":"client/src/components/MaintenanceModule.tsx:473",value:"in_progress",children:e("მიმდინარე","In Progress")}),t.jsx(E,{"data-loc":"client/src/components/MaintenanceModule.tsx:474",value:"completed",children:e("დასრულებული","Completed")})]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:479",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:480",className:"text-sm font-medium mb-2 block",children:e("ღირებულება","Cost")}),t.jsx(Z,{"data-loc":"client/src/components/MaintenanceModule.tsx:483",type:"number",step:"0.01",value:s.cost||"",onChange:c=>A(n,"cost",parseFloat(c.target.value)||0),placeholder:e("მიუთითეთ ღირებულება","Enter cost")})]}),t.jsx("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:492",className:"flex items-end",children:t.jsxs(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:493",variant:"destructive",size:"sm",onClick:()=>C(n),className:"w-full",children:[t.jsx(Rt,{"data-loc":"client/src/components/MaintenanceModule.tsx:499",className:"h-4 w-4 mr-2"}),e("წაშლა","Remove")]})})]})},n)),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:507",className:"flex gap-2",children:[t.jsxs(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:508",onClick:j,variant:"outline",className:"flex-1",children:[t.jsx(ee,{"data-loc":"client/src/components/MaintenanceModule.tsx:509",className:"mr-2 h-4 w-4"}),e("ახალი ჩანაწერი","Add Entry")]}),i.length>0&&t.jsx(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:513",onClick:It,className:"flex-1",children:e("შენახვა","Save All")})]})]})]}),t.jsxs(b,{"data-loc":"client/src/components/MaintenanceModule.tsx:521",children:[t.jsx(kt,{"data-loc":"client/src/components/MaintenanceModule.tsx:522",children:t.jsx(Tt,{"data-loc":"client/src/components/MaintenanceModule.tsx:523"})}),t.jsx(Et,{"data-loc":"client/src/components/MaintenanceModule.tsx:525",children:t.jsx("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:526",className:"overflow-x-auto",children:t.jsxs("table",{"data-loc":"client/src/components/MaintenanceModule.tsx:527",className:"w-full",children:[t.jsx("thead",{"data-loc":"client/src/components/MaintenanceModule.tsx:528",children:t.jsxs("tr",{"data-loc":"client/src/components/MaintenanceModule.tsx:529",className:"border-b",children:[t.jsx("th",{"data-loc":"client/src/components/MaintenanceModule.tsx:530",className:"text-left p-2",children:e("თარიღი","Date")}),t.jsx("th",{"data-loc":"client/src/components/MaintenanceModule.tsx:531",className:"text-left p-2",children:e("ოთახი","Room")}),t.jsx("th",{"data-loc":"client/src/components/MaintenanceModule.tsx:532",className:"text-left p-2",children:e("პრობლემა","Problem")}),t.jsx("th",{"data-loc":"client/src/components/MaintenanceModule.tsx:533",className:"text-left p-2",children:e("შენიშვნა","Notes")}),t.jsx("th",{"data-loc":"client/src/components/MaintenanceModule.tsx:534",className:"text-left p-2",children:e("სტატუსი","Status")}),t.jsx("th",{"data-loc":"client/src/components/MaintenanceModule.tsx:535",className:"text-left p-2",children:e("მოგვარების თარიღი","Solving Date")}),t.jsx("th",{"data-loc":"client/src/components/MaintenanceModule.tsx:536",className:"text-left p-2",children:e("ღირებულება","Cost")}),t.jsx("th",{"data-loc":"client/src/components/MaintenanceModule.tsx:537",className:"text-right p-2",children:e("მოქმედება","Actions")})]})}),t.jsx("tbody",{"data-loc":"client/src/components/MaintenanceModule.tsx:540",children:p?.map(s=>t.jsxs("tr",{"data-loc":"client/src/components/MaintenanceModule.tsx:542",className:"border-b hover:bg-muted/50",children:[t.jsx("td",{"data-loc":"client/src/components/MaintenanceModule.tsx:543",className:"p-2",children:t.jsx(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:544",variant:"link",className:"p-0 h-auto font-normal",onClick:()=>O(s),children:k(new Date(s.scheduled_date),"PPP")})}),t.jsxs("td",{"data-loc":"client/src/components/MaintenanceModule.tsx:552",className:"p-2",children:[e("ოთახი","Room")," #",s.room_number]}),t.jsx("td",{"data-loc":"client/src/components/MaintenanceModule.tsx:553",className:"p-2",children:s.problem}),t.jsx("td",{"data-loc":"client/src/components/MaintenanceModule.tsx:554",className:"p-2",children:s.notes||"-"}),t.jsx("td",{"data-loc":"client/src/components/MaintenanceModule.tsx:555",className:"p-2",children:wt(s.status)}),t.jsx("td",{"data-loc":"client/src/components/MaintenanceModule.tsx:556",className:"p-2",children:s.solving_date?k(new Date(s.solving_date),"PPP"):"-"}),t.jsx("td",{"data-loc":"client/src/components/MaintenanceModule.tsx:561",className:"p-2",children:s.cost?`${s.cost} ₾`:"-"}),t.jsx("td",{"data-loc":"client/src/components/MaintenanceModule.tsx:564",className:"p-2",children:t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:565",className:"flex gap-2 justify-end",children:[t.jsx("input",{"data-loc":"client/src/components/MaintenanceModule.tsx:566",ref:x,type:"file",multiple:!0,accept:"image/*,video/*",className:"hidden",onChange:n=>z(s.id,n.target.files)}),t.jsx(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:574",size:"sm",variant:"outline",onClick:()=>x.current?.click(),disabled:H,children:t.jsx(Ct,{"data-loc":"client/src/components/MaintenanceModule.tsx:580",className:"h-4 w-4"})}),t.jsx(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:582",size:"sm",variant:"outline",onClick:()=>at(s),children:t.jsx(se,{"data-loc":"client/src/components/MaintenanceModule.tsx:587",className:"h-4 w-4"})}),t.jsx(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:589",size:"sm",variant:"destructive",onClick:()=>I.mutate(s.id),children:t.jsx(Rt,{"data-loc":"client/src/components/MaintenanceModule.tsx:594",className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),t.jsx(jt,{"data-loc":"client/src/components/MaintenanceModule.tsx:606",open:M,onOpenChange:m,children:t.jsxs(bt,{"data-loc":"client/src/components/MaintenanceModule.tsx:607",children:[t.jsx(ft,{"data-loc":"client/src/components/MaintenanceModule.tsx:608",children:t.jsx(Mt,{"data-loc":"client/src/components/MaintenanceModule.tsx:609",children:e("რედაქტირება","Edit Entry")})}),l&&t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:612",className:"space-y-4",children:[t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:613",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:614",className:"text-sm font-medium mb-2 block",children:e("თარიღი","Date")}),t.jsxs(xt,{"data-loc":"client/src/components/MaintenanceModule.tsx:617",children:[t.jsx(ut,{"data-loc":"client/src/components/MaintenanceModule.tsx:618",asChild:!0,children:t.jsxs(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:619",variant:"outline",className:"w-full justify-start",children:[t.jsx(ct,{"data-loc":"client/src/components/MaintenanceModule.tsx:620",className:"mr-2 h-4 w-4"}),k(l.scheduled_date,"PPP")]})}),t.jsx(pt,{"data-loc":"client/src/components/MaintenanceModule.tsx:624",className:"w-auto p-0",children:t.jsx(ht,{"data-loc":"client/src/components/MaintenanceModule.tsx:625",mode:"single",selected:l.scheduled_date,onSelect:s=>s&&R({...l,scheduled_date:s}),initialFocus:!0,className:u("p-3 pointer-events-auto")})})]})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:639",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:640",className:"text-sm font-medium mb-2 block",children:e("ოთახი","Room")}),t.jsxs(tt,{"data-loc":"client/src/components/MaintenanceModule.tsx:643",value:l.room_number,onValueChange:s=>R({...l,room_number:s}),children:[t.jsx(et,{"data-loc":"client/src/components/MaintenanceModule.tsx:649",children:t.jsx(st,{"data-loc":"client/src/components/MaintenanceModule.tsx:650"})}),t.jsx(nt,{"data-loc":"client/src/components/MaintenanceModule.tsx:652",children:X?.map(s=>t.jsxs(E,{"data-loc":"client/src/components/MaintenanceModule.tsx:654",value:s.room_number,children:[e("ოთახი","Room")," #",s.room_number]},s.id))})]})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:662",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:663",className:"text-sm font-medium mb-2 block",children:e("პრობლემა","Problem")}),t.jsx(Z,{"data-loc":"client/src/components/MaintenanceModule.tsx:666",value:l.problem,onChange:s=>R({...l,problem:s.target.value})})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:674",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:675",className:"text-sm font-medium mb-2 block",children:e("შენიშვნა","Notes")}),t.jsx(vt,{"data-loc":"client/src/components/MaintenanceModule.tsx:678",value:l.notes,onChange:s=>R({...l,notes:s.target.value})})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:686",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:687",className:"text-sm font-medium mb-2 block",children:e("სტატუსი","Status")}),t.jsxs(tt,{"data-loc":"client/src/components/MaintenanceModule.tsx:690",value:l.status,onValueChange:s=>R({...l,status:s}),children:[t.jsx(et,{"data-loc":"client/src/components/MaintenanceModule.tsx:696",children:t.jsx(st,{"data-loc":"client/src/components/MaintenanceModule.tsx:697"})}),t.jsxs(nt,{"data-loc":"client/src/components/MaintenanceModule.tsx:699",children:[t.jsx(E,{"data-loc":"client/src/components/MaintenanceModule.tsx:700",value:"pending",children:e("მოლოდინში","Pending")}),t.jsx(E,{"data-loc":"client/src/components/MaintenanceModule.tsx:701",value:"in_progress",children:e("მიმდინარე","In Progress")}),t.jsx(E,{"data-loc":"client/src/components/MaintenanceModule.tsx:702",value:"completed",children:e("დასრულებული","Completed")})]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:707",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:708",className:"text-sm font-medium mb-2 block",children:e("მოგვარების თარიღი","Solving Date")}),t.jsxs(xt,{"data-loc":"client/src/components/MaintenanceModule.tsx:711",children:[t.jsx(ut,{"data-loc":"client/src/components/MaintenanceModule.tsx:712",asChild:!0,children:t.jsxs(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:713",variant:"outline",className:"w-full justify-start",children:[t.jsx(ct,{"data-loc":"client/src/components/MaintenanceModule.tsx:714",className:"mr-2 h-4 w-4"}),l.solving_date?k(l.solving_date,"PPP"):e("აირჩიეთ თარიღი","Pick a date")]})}),t.jsx(pt,{"data-loc":"client/src/components/MaintenanceModule.tsx:720",className:"w-auto p-0",children:t.jsx(ht,{"data-loc":"client/src/components/MaintenanceModule.tsx:721",mode:"single",selected:l.solving_date||void 0,onSelect:s=>R({...l,solving_date:s||null}),initialFocus:!0,className:u("p-3 pointer-events-auto")})})]})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:734",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:735",className:"text-sm font-medium mb-2 block",children:e("ღირებულება","Cost")}),t.jsx(Z,{"data-loc":"client/src/components/MaintenanceModule.tsx:738",type:"number",step:"0.01",value:l.cost||"",onChange:s=>R({...l,cost:parseFloat(s.target.value)||0}),placeholder:e("მიუთითეთ ღირებულება","Enter cost")})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:749",className:"flex gap-2",children:[t.jsx(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:750",onClick:Ot,className:"flex-1",children:e("შენახვა","Save")}),t.jsx(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:753",variant:"outline",onClick:()=>m(!1),className:"flex-1",children:e("გაუქმება","Cancel")})]})]})]})}),t.jsx(jt,{"data-loc":"client/src/components/MaintenanceModule.tsx:766",open:D,onOpenChange:v,children:t.jsxs(bt,{"data-loc":"client/src/components/MaintenanceModule.tsx:767",className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[t.jsx(ft,{"data-loc":"client/src/components/MaintenanceModule.tsx:768",children:t.jsx(Mt,{"data-loc":"client/src/components/MaintenanceModule.tsx:769",children:e("დეტალური ინფორმაცია","Detail View")})}),o&&t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:772",className:"space-y-6",children:[t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:773",className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:774",children:[t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:775",className:"text-sm text-muted-foreground",children:e("თარიღი","Date")}),t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:776",className:"font-medium",children:k(new Date(o.scheduled_date),"PPP")})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:780",children:[t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:781",className:"text-sm text-muted-foreground",children:e("ოთახი","Room")}),t.jsxs("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:782",className:"font-medium",children:[e("ოთახი","Room")," #",o.room_number]})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:786",children:[t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:787",className:"text-sm text-muted-foreground",children:e("პრობლემა","Problem")}),t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:788",className:"font-medium",children:o.problem})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:790",children:[t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:791",className:"text-sm text-muted-foreground",children:e("სტატუსი","Status")}),t.jsx("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:792",className:"mt-1",children:wt(o.status)})]})]}),o.notes&&t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:797",children:[t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:798",className:"text-sm text-muted-foreground mb-1",children:e("შენიშვნა","Notes")}),t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:801",className:"text-sm",children:o.notes})]}),o.solving_date&&t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:806",children:[t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:807",className:"text-sm text-muted-foreground",children:e("მოგვარების თარიღი","Solving Date")}),t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:810",className:"font-medium",children:k(new Date(o.solving_date),"PPP")})]}),o.cost&&t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:817",children:[t.jsx("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:818",className:"text-sm text-muted-foreground",children:e("ღირებულება","Cost")}),t.jsxs("p",{"data-loc":"client/src/components/MaintenanceModule.tsx:821",className:"font-medium",children:[o.cost," ₾"]})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:825",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:826",className:"text-sm font-medium mb-2 block",children:e("დამატებითი კომენტარი","Additional Comments")}),t.jsx(vt,{"data-loc":"client/src/components/MaintenanceModule.tsx:829",defaultValue:o.additional_notes||"",onBlur:s=>h(o.id,s.target.value),placeholder:e("დაამატეთ კომენტარი...","Add comment..."),rows:3})]}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:839",children:[t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:840",className:"flex items-center justify-between mb-3",children:[t.jsx("label",{"data-loc":"client/src/components/MaintenanceModule.tsx:841",className:"text-sm font-medium",children:e("ფოტო და ვიდეო","Photos & Videos")}),t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:844",children:[t.jsx("input",{"data-loc":"client/src/components/MaintenanceModule.tsx:845",ref:y,type:"file",multiple:!0,accept:"image/*,video/*",className:"hidden",onChange:s=>z(o.id,s.target.files)}),t.jsxs(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:855",size:"sm",variant:"outline",onClick:()=>y.current?.click(),disabled:H,children:[t.jsx(Ct,{"data-loc":"client/src/components/MaintenanceModule.tsx:861",className:"h-4 w-4 mr-2"}),e("ატვირთვა","Upload")]})]})]}),t.jsx("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:867",className:"grid grid-cols-3 gap-3",children:o.media_urls?.map((s,n)=>t.jsxs("div",{"data-loc":"client/src/components/MaintenanceModule.tsx:869",className:"relative group",children:[s.match(/\.(jpg|jpeg|png|gif|webp)$/i)?t.jsx("img",{"data-loc":"client/src/components/MaintenanceModule.tsx:871",src:s,alt:`Media ${n+1}`,className:"w-full h-32 object-cover rounded-lg"}):t.jsx("video",{"data-loc":"client/src/components/MaintenanceModule.tsx:877",src:s,controls:!0,className:"w-full h-32 object-cover rounded-lg"}),t.jsx(S,{"data-loc":"client/src/components/MaintenanceModule.tsx:883",size:"sm",variant:"destructive",className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>it(o.id,s),children:t.jsx(ne,{"data-loc":"client/src/components/MaintenanceModule.tsx:889",className:"h-3 w-3"})})]},n))})]})]})]})})]})};function Me(){const{t:e}=F(),{data:d,isLoading:a}=Q.logistics.activityLog.list.useQuery({limit:100}),x=r=>{const M={create:{variant:"default",label:e("შექმნა","Created")},update:{variant:"secondary",label:e("განახლდა","Updated")},delete:{variant:"destructive",label:e("წაიშალა","Deleted")}},m=M[r]||M.update;return t.jsx(L,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:34",variant:m.variant,children:m.label})},y=r=>({room:t.jsx(G,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:39",className:"h-4 w-4"}),inventory_item:t.jsx(G,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:40",className:"h-4 w-4"}),housekeeping_schedule:t.jsx(Ht,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:41",className:"h-4 w-4"}),maintenance_schedule:t.jsx(Pt,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:42",className:"h-4 w-4"})})[r]||t.jsx(G,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:44",className:"h-4 w-4"}),i=r=>({room:e("ოთახი","Room"),inventory_item:e("ინვენტარი","Inventory"),housekeeping_schedule:e("დასუფთავება","Housekeeping"),maintenance_schedule:e("ტექნიკური","Maintenance")})[r]||r;return a?t.jsx(b,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:59",className:"p-6",children:t.jsx("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:60",className:"flex items-center justify-center",children:t.jsx($,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:61",className:"h-8 w-8 animate-spin text-primary"})})}):t.jsxs(b,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:68",className:"p-6",children:[t.jsxs("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:69",className:"flex items-center gap-2 mb-4",children:[t.jsx(yt,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:70",className:"h-5 w-5 text-primary"}),t.jsx("h3",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:71",className:"text-lg font-semibold",children:e("აქტივობის ლოგი","Activity Log")})]}),t.jsx("p",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:75",className:"text-sm text-muted-foreground mb-4",children:e("ყველა ცვლილების ისტორია Logistics მოდულში","History of all changes in Logistics module")}),t.jsx(Nt,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:82",className:"h-[600px]",children:t.jsx("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:83",className:"space-y-3",children:d&&d.length>0?d.map(r=>t.jsx(b,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:86",className:"p-4 border-l-4 border-l-primary/50",children:t.jsx("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:87",className:"flex items-start justify-between gap-4",children:t.jsxs("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:88",className:"flex items-start gap-3 flex-1",children:[t.jsx("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:89",className:"mt-1",children:y(r.entityType)}),t.jsxs("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:90",className:"flex-1 space-y-1",children:[t.jsxs("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:91",className:"flex items-center gap-2 flex-wrap",children:[x(r.action),t.jsx("span",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:93",className:"font-medium",children:i(r.entityType)}),r.entityName&&t.jsxs("span",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:95",className:"text-sm text-muted-foreground",children:["• ",r.entityName]})]}),t.jsxs("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:101",className:"flex items-center gap-2 text-sm text-muted-foreground",children:[t.jsx(ae,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:102",className:"h-3 w-3"}),t.jsx("span",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:103",children:r.userEmail||e("უცნობი","Unknown")}),t.jsx(oe,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:104",className:"h-3 w-3 ml-2"}),t.jsx("span",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:105",children:k(new Date(r.createdAt),"PPp")})]}),r.changes&&Object.keys(r.changes).length>0&&t.jsxs("details",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:109",className:"mt-2",children:[t.jsx("summary",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:110",className:"text-sm text-primary cursor-pointer hover:underline",children:e("ცვლილებები","Changes")}),t.jsx("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:113",className:"mt-2 p-2 bg-muted rounded text-xs",children:t.jsx("pre",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:114",className:"whitespace-pre-wrap",children:JSON.stringify(r.changes,null,2)})})]})]})]})})},r.id)):t.jsxs("div",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:126",className:"text-center text-muted-foreground py-8",children:[t.jsx(yt,{"data-loc":"client/src/components/LogisticsActivityLog.tsx:127",className:"h-12 w-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{"data-loc":"client/src/components/LogisticsActivityLog.tsx:128",children:e("ჯერ არ არის აქტივობა","No activity yet")})]})})})]})}const Ne=()=>{const{t:e}=F();f.useEffect(()=>{const d=async()=>{const{data:{user:x}}=await _.auth.getUser();return x?.id};(async()=>{const x=await d(),y=_.channel("logistics-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"logistics_activity_log"},i=>{const r=i.new;if(r.user_id===x)return;const M={create:e("შექმნა","created"),update:e("განაახლა","updated"),delete:e("წაშალა","deleted")}[r.action]||r.action,m={room:e("ოთახი","room"),inventory_item:e("ინვენტარის ელემენტი","inventory item"),housekeeping_schedule:e("დასუფთავების გრაფიკი","housekeeping schedule"),maintenance_schedule:e("ტექნიკური გრაფიკი","maintenance schedule")}[r.entity_type]||r.entity_type;pe({title:e("ახალი ცვლილება","New Change"),description:`${r.user_email||e("მომხმარებელმა","User")} ${M} ${m}${r.entity_name?`: ${r.entity_name}`:""}`,duration:5e3})}).subscribe();return()=>{_.removeChannel(y)}})()},[e])},qe=()=>{ce();const{t:e}=F(),[d,a]=f.useState(!1);return Ne(),f.useEffect(()=>{_.auth.getSession().then(({data:{session:x}})=>{a(!!x)})},[]),t.jsxs("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:32",className:"min-h-screen bg-background",children:[t.jsx("header",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:33",className:"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50",children:t.jsx("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:34",className:"container mx-auto px-6 py-4",children:t.jsxs("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:35",className:"flex items-center gap-4",children:[d&&t.jsxs(S,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:37",variant:"ghost",size:"sm",onClick:()=>setLocation("/"),children:[t.jsx(le,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:38",className:"h-4 w-4 mr-2"}),e("უკან","Back")]}),t.jsxs("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:42",className:"flex items-center gap-3",children:[t.jsx("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:43",className:"flex h-10 w-10 items-center justify-center rounded-lg bg-gradient-ai",children:t.jsx(G,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:44",className:"h-6 w-6 text-primary-foreground"})}),t.jsxs("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:46",children:[t.jsx("h1",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:47",className:"text-xl font-bold text-foreground",children:e("ოთახები და დასუფთავება","Rooms & Housekeeping")}),t.jsx("p",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:50",className:"text-xs text-muted-foreground",children:e("სტუდიოების ინვენტარის მართვა და ანალიტიკა","Studio inventory management and analytics")})]})]})]})})}),t.jsx("main",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:59",className:"container mx-auto px-6 py-8",children:t.jsxs(qt,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:60",defaultValue:"dashboard",className:"w-full",children:[t.jsxs(zt,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:61",className:"grid w-full grid-cols-5 mb-8",children:[t.jsxs(B,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:62",value:"dashboard",className:"flex items-center gap-2",children:[t.jsx(ie,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:63",className:"h-4 w-4"}),e("დეშბორდი","Dashboard")]}),t.jsxs(B,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:66",value:"inventory",className:"flex items-center gap-2",children:[t.jsx(G,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:67",className:"h-4 w-4"}),e("ინვენტარი","Inventory")]}),t.jsxs(B,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:70",value:"housekeeping",className:"flex items-center gap-2",children:[t.jsx(Ht,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:71",className:"h-4 w-4"}),e("დასუფთავება","Housekeeping")]}),t.jsxs(B,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:74",value:"maintenance",className:"flex items-center gap-2",children:[t.jsx(Pt,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:75",className:"h-4 w-4"}),e("ტექნიკური","Maintenance")]}),t.jsxs(B,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:78",value:"activity",className:"flex items-center gap-2",children:[t.jsx(yt,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:79",className:"h-4 w-4"}),e("აქტივობა","Activity")]})]}),t.jsx(K,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:84",value:"dashboard",children:t.jsx(f.Suspense,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:85",fallback:t.jsx("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:86",className:"flex items-center justify-center p-12",children:t.jsx($,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:87",className:"h-8 w-8 animate-spin text-primary"})}),children:t.jsx(he,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:90"})})}),t.jsx(K,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:94",value:"inventory",children:t.jsx(f.Suspense,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:95",fallback:t.jsx("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:96",className:"flex items-center justify-center p-12",children:t.jsx($,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:97",className:"h-8 w-8 animate-spin text-primary"})}),children:t.jsx(je,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:100"})})}),t.jsx(K,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:104",value:"housekeeping",children:t.jsx(f.Suspense,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:105",fallback:t.jsx("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:106",className:"flex items-center justify-center p-12",children:t.jsx($,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:107",className:"h-8 w-8 animate-spin text-primary"})}),children:t.jsx(ue,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:110"})})}),t.jsx(K,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:114",value:"maintenance",children:t.jsx(f.Suspense,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:115",fallback:t.jsx("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:116",className:"flex items-center justify-center p-12",children:t.jsx($,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:117",className:"h-8 w-8 animate-spin text-primary"})}),children:t.jsx(fe,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:120"})})}),t.jsx(K,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:124",value:"activity",children:t.jsx(f.Suspense,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:125",fallback:t.jsx("div",{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:126",className:"flex items-center justify-center p-12",children:t.jsx($,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:127",className:"h-8 w-8 animate-spin text-primary"})}),children:t.jsx(Me,{"data-loc":"client/src/pages/logistics/LogisticsDashboard.tsx:130"})})})]})})]})};export{qe as default};
